<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>WhatsApp Chat Generator</title>
    <link rel="stylesheet" href="Style/style.css">
</head>

<body>
    <!-- Chat Window  -->
    <div class="mainCont">
        <div class="phone-window">
            <div class="nav-bar">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXElEQVR4nO2WQQqAMAwE/f9P8ygFj1K0pYvQwEMgM8mGEFgGg8FgMBgMBoPBYDAY3sADOAEX4AhsgC3lz8A+9W7AIdV2wCvVXj1/9Qx0Z6A7A90Z6M4A4wH7Cg2wDd3e1QAAAABJRU5ErkJggg=="
                    class="profile-pic" id="profilePic">
                <div class="user-info">
                    <div id="userName">User</div>
                    <small id="lastSeen">last seen today</small>
                </div>
            </div>
            <div class="message-area" id="messageArea"></div>
        </div>

        <div class="controls">
            <input type="text" id="messageInput" placeholder="Type message">
            <button onclick="sendMessage('user1')">Send as User1</button>
            <button onclick="sendMessage('user2')">Send as User2</button>

            <div>
                <input type="file" id="imageUpload" accept="image/*" hidden>
                <input type="file" id="docUpload" hidden>
                <button onclick="document.getElementById('imageUpload').click()">Send Image</button>
                <button onclick="document.getElementById('docUpload').click()">Send Document</button>
            </div>

            <button onclick="deleteMessage()">Delete Selected</button>
            <button onclick="clearChats()">Clear Chats</button>
            <button onclick="cleanAll()">Clean All</button>

            <input type="text" id="newName" placeholder="New username">
            <button onclick="updateUsername()">Update Name</button>

            <input type="text" id="statusInput" placeholder="New status">
            <button onclick="updateStatus()">Update Status</button>

            <input type="file" id="profileUpload" accept="image/*" hidden>
            <button onclick="document.getElementById('profileUpload').click()">Upload Profile Pic</button>

            <div>
                <button onclick="toggleTime(true)">Auto Time</button>
                <button onclick="toggleTime(false)">Manual Time</button>
                <div class="time-input-container" id="manualTimeContainer" style="display: none;">
                    <input type="number" id="manualHour" min="1" max="12" placeholder="HH" style="width: 50px;">
                    <input type="number" id="manualMin" min="0" max="59" placeholder="MM" style="width: 50px;">
                    <select id="manualPeriod">
                        <option>AM</option>
                        <option>PM</option>
                    </select>
                </div>
            </div>

            <button onclick="downloadScreenshot()">Download Screenshot</button>
            <button onclick="deselectMessage()" id="deselectBtn" style="display: none;">Deselect</button>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        let messages = [];
        let selectedMessage = null;
        let autoTime = true;
        let currentUser = 'User';
        let lastSeenStatus = 'last seen today';

        // Initialize
        loadData();
        updateUI();

        // Event Listeners
        document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
        document.getElementById('docUpload').addEventListener('change', handleDocUpload);
        document.getElementById('profileUpload').addEventListener('change', updateProfilePic);
        document.getElementById('manualTime').addEventListener('change', updateManualTime);

        function sendMessage(sender) {
            const input = document.getElementById('messageInput');
            const content = input.value.trim();
            if (!content) return;

            const message = {
                id: Date.now(),
                sender,
                type: 'text',
                content,
                time: getCurrentTime()
            };

            messages.push(message);
            input.value = '';
            updateUI();
            saveData();
        }

        function handleImageUpload(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function () {
                messages.push({
                    id: Date.now(),
                    sender: 'user1',
                    type: 'image',
                    content: reader.result,
                    time: getCurrentTime()
                });
                updateUI();
                saveData();
            };
            reader.readAsDataURL(file);
        }

        function handleDocUpload(e) {
            const file = e.target.files[0];
            messages.push({
                id: Date.now(),
                sender: 'user1',
                type: 'document',
                content: {
                    name: file.name,
                    size: (file.size / 1024).toFixed(2) + ' KB'
                },
                time: getCurrentTime()
            });
            updateUI();
            saveData();
        }

        function updateUI() {
            const area = document.getElementById('messageArea');
            area.innerHTML = messages.map(msg => `
                <div class="message ${msg.sender} ${selectedMessage === msg.id ? 'selected' : ''}" 
                     id="msg-${msg.id}" ondblclick="selectMessage(${msg.id})">
                    ${msg.type === 'image' ?
                    `<img src="${msg.content}" class="image-message">` :
                    msg.type === 'document' ?
                        `<div class="document-message">
                            ðŸ“„ ${msg.content.name}<br>
                            <small>${msg.content.size}</small>
                        </div>` :
                        msg.content}
                    <span class="time-stamp">${msg.time}</span>
                </div>
            `).join('');

            document.getElementById('userName').textContent = currentUser;
            document.getElementById('lastSeen').textContent = lastSeenStatus;
        }

        function selectMessage(id) {
            if (selectedMessage === id) return;
            selectedMessage = id;
            document.getElementById('deselectBtn').style.display = 'block';
            updateUI();
        }

        function deselectMessage() {
            selectedMessage = null;
            document.getElementById('deselectBtn').style.display = 'none';
            updateUI();
        }

        function deleteMessage() {
            messages = messages.filter(msg => msg.id !== selectedMessage);
            deselectMessage();
            saveData();
        }

        function clearChats() {
            messages = [];
            updateUI();
            saveData();
        }

        function cleanAll() {
            localStorage.clear();
            currentUser = 'User';
            lastSeenStatus = 'last seen today';
            messages = [];
            document.getElementById('profilePic').src = 'data:image/png;base64,iVBORw0...';
            updateUI();
        }

        function updateUsername() {
            const newName = document.getElementById('newName').value;
            if (newName) {
                currentUser = newName;
                saveData();
                updateUI();
            }
        }

        function updateStatus() {
            const status = document.getElementById('statusInput').value;
            if (status) {
                lastSeenStatus = status;
                saveData();
                updateUI();
            }
        }

        function updateProfilePic(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function () {
                document.getElementById('profilePic').src = reader.result;
                saveData();
            };
            reader.readAsDataURL(file);
        }

        function toggleTime(auto) {
            autoTime = auto;
            document.getElementById('manualTime').disabled = auto;
        }

        function updateManualTime(e) {
            if (!autoTime) {
                // Update all messages time if needed
            }
        }

        function getCurrentTime() {
            return autoTime ?
                new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) :
                document.getElementById('manualTime').value || '10:00 AM';
        }

        function downloadScreenshot() {
            html2canvas(document.querySelector('.phone-window')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'whatsapp-chat.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function saveData() {
            const data = {
                messages,
                currentUser,
                lastSeenStatus,
                profilePic: document.getElementById('profilePic').src
            };
            localStorage.setItem('whatsappData', JSON.stringify(data));
        }

        function loadData() {
            const data = JSON.parse(localStorage.getItem('whatsappData'));
            if (data) {
                messages = data.messages || [];
                currentUser = data.currentUser || 'User';
                lastSeenStatus = data.lastSeenStatus || 'last seen today';
                document.getElementById('profilePic').src = data.profilePic || 'data:image/png;base64,iVBORw0...';
            }
        }
    </script>
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <style>
            /* Add/Update these styles */
            .quoted-message {
                border-left: 3px solid #25d366;
                padding: 4px 8px;
                margin: 6px 0;
                background: rgba(0, 0, 0, 0.05);
                border-radius: 4px;
                font-size: 0.9em;
                color: #666;
                max-width: 80%;
            }

            .quoted-sender {
                font-weight: bold;
                color: #25d366;
                font-size: 0.8em;
            }

            /* Remove previous reply-indicator styles */
        </style>
    </head>

    <body>
        <!-- Previous HTML remains same -->

        <script>
            // Update time format to 12-hour
            function getCurrentTime() {
                return autoTime ?
                    new Date().toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    }) :
                    document.getElementById('manualTime').value || '10:00 AM';
            }

            // Update message rendering for replies
            function updateUI() {
                const area = document.getElementById('messageArea');
                area.innerHTML = messages.map(msg => {
                    const quotedMessage = messages.find(m => m.id === msg.replyTo);
                    return `
                   <div class="message ${msg.sender} ${selectedMessage === msg.id ? 'selected' : ''}" 
                        id="msg-${msg.id}" ondblclick="selectMessage(${msg.id})">
                       ${msg.replyTo ? `
                           <div class="quoted-message">
                               <div class="quoted-sender">
                                   ${quotedMessage ? (quotedMessage.sender === 'user1' ? 'You' : 'User2') : 'Deleted message'}
                               </div>
                               ${quotedMessage ?
                                (quotedMessage.type === 'text' ? quotedMessage.content :
                                    quotedMessage.type === 'image' ? 'ðŸ“· Photo' :
                                        quotedMessage.type === 'document' ? 'ðŸ“„ ' + quotedMessage.content.name : '')
                                : ''}
                           </div>
                       ` : ''}
                       ${msg.type === 'image' ?
                            `<img src="${msg.content}" class="image-message">` :
                            msg.type === 'document' ?
                                `<div class="document-message">
                               ðŸ“„ ${msg.content.name}<br>
                               <small>${msg.content.size}</small>
                           </div>` :
                                msg.content}
                       <span class="time-stamp">${msg.time}</span>
                   </div>
                   `;
                }).join('');

                document.getElementById('userName').textContent = currentUser;
                document.getElementById('lastSeen').textContent = lastSeenStatus;
            }

            // Update sendMessage function to include original sender
            function sendMessage(sender) {
                const input = document.getElementById('messageInput');
                const content = input.value.trim();
                if (!content) return;

                const message = {
                    id: Date.now(),
                    sender,
                    type: 'text',
                    content,
                    time: getCurrentTime(),
                    replyTo: selectedMessage,
                    replySender: messages.find(m => m.id === selectedMessage)?.sender
                };

                messages.push(message);
                input.value = '';
                selectedMessage = null;
                document.getElementById('deselectBtn').style.display = 'none';
                updateUI();
                saveData();
            }
        </script>
        <script>
            // Update time handling
            let manualHour = '10';
            let manualMin = '00';
            let manualPeriod = 'AM';

            function getCurrentTime() {
                if (autoTime) {
                    return new Date().toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    });
                } else {
                    return `${manualHour.padStart(2, '0')}:${manualMin.padStart(2, '0')} ${manualPeriod}`;
                }
            }

            // Update manual time controls
            document.getElementById('manualHour').addEventListener('change', function (e) {
                manualHour = Math.max(1, Math.min(12, parseInt(e.target.value) || 1)).toString();
                e.target.value = manualHour;
            });

            document.getElementById('manualMin').addEventListener('change', function (e) {
                manualMin = Math.max(0, Math.min(59, parseInt(e.target.value) || 0)).toString().padStart(2, '0');
                e.target.value = manualMin;
            });

            document.getElementById('manualPeriod').addEventListener('change', function (e) {
                manualPeriod = e.target.value;
            });

            function toggleTime(auto) {
                autoTime = auto;
                document.getElementById('manualTimeContainer').style.display = auto ? 'none' : 'flex';
            }

            // Update message storage
            function saveData() {
                const data = {
                    messages,
                    currentUser,
                    lastSeenStatus,
                    profilePic: document.getElementById('profilePic').src,
                    autoTime,
                    manualHour,
                    manualMin,
                    manualPeriod
                };
                localStorage.setItem('whatsappData', JSON.stringify(data));
            }

            function loadData() {
                const data = JSON.parse(localStorage.getItem('whatsappData'));
                if (data) {
                    messages = data.messages || [];
                    currentUser = data.currentUser || 'User';
                    lastSeenStatus = data.lastSeenStatus || 'last seen today';
                    document.getElementById('profilePic').src = data.profilePic || 'data:image/png;base64,iVBORw0...';
                    autoTime = data.autoTime !== undefined ? data.autoTime : true;
                    manualHour = data.manualHour || '10';
                    manualMin = data.manualMin || '00';
                    manualPeriod = data.manualPeriod || 'AM';

                    // Update manual inputs
                    document.getElementById('manualHour').value = manualHour;
                    document.getElementById('manualMin').value = manualMin;
                    document.getElementById('manualPeriod').value = manualPeriod;
                    toggleTime(autoTime);
                }
            }

            // Update message reply display
            function updateUI() {
                const area = document.getElementById('messageArea');
                area.innerHTML = messages.map(msg => {
                    const quotedMessage = messages.find(m => m.id === msg.replyTo);
                    return `
                    <div class="message ${msg.sender} ${selectedMessage === msg.id ? 'selected' : ''}" 
                         id="msg-${msg.id}" ondblclick="selectMessage(${msg.id})">
                        ${msg.replyTo ? `
                            <div class="quoted-message">
                                <div class="quoted-sender">
                                    ${quotedMessage ? (quotedMessage.sender === 'user1' ? 'You' : 'User2') : 'Deleted message'}
                                </div>
                                ${quotedMessage ?
                                (quotedMessage.type === 'text' ? quotedMessage.content :
                                    quotedMessage.type === 'image' ? 'ðŸ“· Photo' :
                                        quotedMessage.type === 'document' ? 'ðŸ“„ ' + quotedMessage.content.name : '')
                                : ''}
                            </div>
                        ` : ''}
                        ${msg.type === 'image' ?
                            `<img src="${msg.content}" class="image-message">` :
                            msg.type === 'document' ?
                                `<div class="document-message">
                                ðŸ“„ ${msg.content.name}<br>
                                <small>${msg.content.size}</small>
                            </div>` :
                                msg.content}
                        <span class="time-stamp">${msg.time}</span>
                    </div>
                    `;
                }).join('');

                document.getElementById('userName').textContent = currentUser;
                document.getElementById('lastSeen').textContent = lastSeenStatus;
            }
        </script>
    </body>

    </html>
</body>

</html>